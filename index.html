<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒå¤®è¡Œæ¨¡æ“¬å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .news-alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(231, 76, 60, 0.4);
            z-index: 1000;
            min-width: 400px;
            max-width: 80vw;
            display: none;
        }

        .news-alert.quarter-report {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .news-alert.warning {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .news-alert.global-event {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .news-alert.economic-alert {
            background: linear-gradient(45deg, #e67e22, #d35400);
        }

        .news-alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .news-alert-title {
            font-size: 1.1em;
            font-weight: bold;
        }

        .news-alert-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
        }

        .international-dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .country-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }

        .country-panel.current-country {
            border-left-color: #27ae60;
            background: linear-gradient(135deg, #d5f4e6, #ffffff);
        }

        .country-panel.china {
            border-left-color: #e74c3c;
        }

        .country-panel.japan {
            border-left-color: #9b59b6;
        }

        .country-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .country-flag {
            font-size: 1.5em;
            margin-right: 10px;
        }

        .country-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .country-status {
            font-size: 0.8em;
            color: #666;
            margin-left: auto;
        }

        .mini-indicators {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
        }

        .mini-indicators.usa-indicators {
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
        }

        .mini-indicators.usa-indicators .mini-indicator:nth-child(5) {
            grid-column: 1 / 3;
        }

        .mini-indicator {
            text-align: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .mini-indicator.good {
            background: #d5f4e6;
            border: 1px solid #27ae60;
        }

        .mini-indicator.warning {
            background: #fef9e7;
            border: 1px solid #f39c12;
        }

        .mini-indicator.danger {
            background: #fadbd8;
            border: 1px solid #e74c3c;
        }

        .mini-indicator.classified {
            background: #ecf0f1;
            border: 1px solid #95a5a6;
            color: #7f8c8d;
            font-style: italic;
        }

        .mini-indicator-label {
            font-size: 0.75em;
            color: #666;
            margin-bottom: 3px;
        }

        .mini-indicator-value {
            font-size: 1em;
            font-weight: bold;
            color: #2c3e50;
        }

        .quarter-info {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(45deg, #e8f4f8, #d5f4e6);
            border-radius: 10px;
            border-left: 5px solid #27ae60;
        }

        .quarter-info h3 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ddd;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-radius: 5px;
            transition: width 0.1s linear;
            width: 0%;
        }

        .time-display {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .game-board {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 5px solid #3498db;
        }

        .panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .skill-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #e74c3c;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .skill-card.ready {
            border-left-color: #27ae60;
            background: linear-gradient(135deg, #d5f4e6, #f8f9fa);
        }

        .skill-card.cooldown {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, #fef9e7, #f8f9fa);
        }

        .skill-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .skill-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .skill-details {
            flex: 1;
        }

        .skill-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .skill-cooldown {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }

        .skill-cooldown.ready {
            color: #27ae60;
        }

        .skill-cooldown.on-cooldown {
            color: #e74c3c;
        }

        .skill-description {
            color: #666;
            font-size: 0.95em;
            line-height: 1.4;
            margin-bottom: 15px;
            font-style: italic;
        }

        .skill-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .target-selector {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 0.9em;
        }

        .policy-tools {
            display: grid;
            gap: 15px;
        }

        .tool-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .tool-group h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .tool-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .tool-controls label {
            min-width: 100px;
            font-weight: 500;
        }

        .tool-controls input[type="range"] {
            flex: 1;
            height: 8px;
            background: #ddd;
            border-radius: 5px;
            outline: none;
        }

        .tool-controls .value-display {
            min-width: 60px;
            text-align: center;
            font-weight: bold;
            color: #3498db;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }

        button {
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-skill {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
        }

        .btn-skill:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-fiscal {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
            margin: 5px;
            flex: 1;
        }

        .btn-fiscal:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-fiscal:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-fiscal.decrease {
            background: linear-gradient(45deg, #e67e22, #f39c12);
        }

        .btn-fiscal.decrease:hover {
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.3);
        }

        .fiscal-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .fiscal-status {
            text-align: center;
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }

        .btn-emergency {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
            margin-top: 10px;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-emergency:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        }

        .btn-emergency:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .events-log {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .events-log h3 {
            margin-bottom: 15px;
            color: #ecf0f1;
        }

        .event-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 3px solid #3498db;
            animation: slideIn 0.3s ease;
        }

        .event-item.quarter-end {
            border-left-color: #f39c12;
            background: rgba(243, 156, 18, 0.2);
        }

        .event-item.policy-change {
            border-left-color: #9b59b6;
            background: rgba(155, 89, 182, 0.2);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .country-selection {
            text-align: center;
            padding: 40px 20px;
        }

        .country-selection h1 {
            color: #2c3e50;
            margin-bottom: 40px;
            font-size: 2.8em;
        }

        .country-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .country-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .country-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .country-card.selected {
            border-color: #27ae60;
            background: linear-gradient(135deg, #d5f4e6, #ffffff);
        }

        .country-flag-large {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .country-card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .country-description {
            text-align: left;
            line-height: 1.6;
        }

        .country-description p {
            margin-bottom: 10px;
            color: #666;
        }

        .skill-preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #3498db;
        }

        .skill-preview h4 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .skill-preview p {
            font-size: 0.9em;
            color: #555;
            margin: 0;
        }

        .btn-start {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn-start:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-start:not(:disabled):hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(39, 174, 96, 0.4);
        }

        .game-content {
            display: none;
        }

        @media (max-width: 768px) {
            .game-board {
                grid-template-columns: 1fr;
            }
            
            .international-dashboard {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- åœ‹å®¶é¸æ“‡ç•«é¢ -->
        <div class="country-selection" id="countrySelection">
            <h1>ğŸŒ é¸æ“‡ä½ è¦æ‰®æ¼”çš„åœ‹å®¶</h1>
            <div class="country-cards">
                <div class="country-card" data-country="USA">
                    <div class="country-flag-large">ğŸ‡ºğŸ‡¸</div>
                    <h2>ç¾åœ‹</h2>
                    <div class="country-description">
                        <p><strong>ç‰¹è‰²ï¼š</strong>å…¨çƒéœ¸ä¸»ï¼Œæ”¿ç­–å½±éŸ¿å…¨ä¸–ç•Œ</p>
                        <p><strong>å„ªå‹¢ï¼š</strong>ç¾å…ƒéœ¸æ¬Šï¼Œæ”¿ç­–å‚³å°åŠ›å¼·</p>
                        <p><strong>æŒ‘æˆ°ï¼š</strong>å…¨çƒè²¬ä»»é‡å¤§ï¼Œæ”¿ç­–å¤±èª¤å½±éŸ¿å»£</p>
                        <div class="skill-preview">
                            <h4>âš”ï¸ å°ˆå±¬æŠ€èƒ½ï¼šç¶“æ¿Ÿåˆ¶è£</h4>
                            <p>å°ç›®æ¨™åœ‹å®¶å¯¦æ–½åš´å²åˆ¶è£ï¼Œé€ æˆæŒçºŒ2å­£çš„é¡¯è‘—è² é¢å½±éŸ¿ï¼Œä½†æœ‰35%æ©Ÿç‡åå™¬è‡ªèº«</p>
                        </div>
                    </div>
                </div>
                
                <div class="country-card" data-country="CHN">
                    <div class="country-flag-large">ğŸ‡¨ğŸ‡³</div>
                    <h2>ä¸­åœ‹</h2>
                    <div class="country-description">
                        <p><strong>ç‰¹è‰²ï¼š</strong>ä¸–ç•Œå·¥å» ï¼Œé«˜é€Ÿç™¼å±•ä¸­ç¶“æ¿Ÿé«”</p>
                        <p><strong>å„ªå‹¢ï¼š</strong>æ”¿ç­–åŸ·è¡ŒåŠ›å¼·ï¼Œæˆé•·æ½›åŠ›å¤§</p>
                        <p><strong>æŒ‘æˆ¦ï¼š</strong>çµæ§‹è½‰å‹å£“åŠ›ï¼Œå¤–éƒ¨ä¾è³´åº¦é«˜</p>
                        <div class="skill-preview">
                            <h4>ğŸš€ å°ˆå±¬æŠ€èƒ½ï¼šç§‘æŠ€çªç ´</h4>
                            <p>é›†ä¸­åŠ›é‡è¾¦å¤§äº‹ï¼Œå¯¦ç¾é‡å¤§ç§‘æŠ€çªç ´ï¼Œå¤§å¹…æå‡GDPæˆé•·å’Œæ°‘çœ¾ä¿¡å¿ƒï¼Œç„¡æ˜é¡¯å‰¯ä½œç”¨</p>
                        </div>
                    </div>
                </div>
                
                <div class="country-card" data-country="JPN">
                    <div class="country-flag-large">ğŸ‡¯ğŸ‡µ</div>
                    <h2>æ—¥æœ¬</h2>
                    <div class="country-description">
                        <p><strong>ç‰¹è‰²ï¼š</strong>æˆç†Ÿç™¼é”ç¶“æ¿Ÿé«”ï¼ŒæŠ€è¡“å…ˆé€²</p>
                        <p><strong>å„ªå‹¢ï¼š</strong>è²¨å¹£æ”¿ç­–ç¶“é©—è±å¯Œï¼ŒæŠ€è¡“é ˜å…ˆ</p>
                        <p><strong>æŒ‘æˆ°ï¼š</strong>äººå£è€åŒ–ï¼Œé€šç¸®é¢¨éšª</p>
                        <div class="skill-preview">
                            <h4>ğŸ¯ å°ˆå±¬æŠ€èƒ½ï¼šæ”¹å–„è€äººå°±æ¥­å•é¡Œ</h4>
                            <p>é€éæ•¸ä½åŒ–åŸ¹è¨“å’Œå½ˆæ€§å·¥ä½œåˆ¶åº¦ï¼Œæå‡é«˜é½¡å‹å‹•åƒèˆ‡ç‡ï¼Œè§£æ±ºé€šç¸®å’Œä¿¡å¿ƒå•é¡Œ</p>
                        </div>
                    </div>
                </div>
            </div>
            <button class="btn-start" id="startGameBtn" disabled>é–‹å§‹éŠæˆ²</button>
        </div>

        <!-- éŠæˆ²ä¸»ç•Œé¢ -->
        <div class="game-content" id="gameContent">
            <!-- å¿«è¨Šå½ˆçª— -->
            <div class="news-alert" id="newsAlert">
                <div class="news-alert-header">
                    <span class="news-alert-title" id="newsAlertTitle">ç·Šæ€¥å¿«è¨Š</span>
                    <button class="news-alert-close" id="closeAlertBtn">Ã—</button>
                </div>
                <div class="news-alert-content" id="newsAlertContent">
                    å¿«è¨Šå…§å®¹
                </div>
            </div>

            <h1 id="gameTitle">ğŸ¦ å…¨çƒå¤®è¡Œæ¨¡æ“¬å™¨</h1>
            
            <!-- åœ‹éš›ç¶“æ¿Ÿå„€è¡¨æ¿ -->
            <div class="international-dashboard" id="internationalDashboard">
                <!-- å‹•æ…‹ç”Ÿæˆåœ‹å®¶é¢æ¿ -->
            </div>
            
            <div class="quarter-info">
                <h3>ç•¶å‰å­£åº¦ï¼šç¬¬ <span id="currentQuarter">1</span> å­£</h3>
                <p>èª¿æ•´æ”¿ç­–å·¥å…·å³æ™‚å½±éŸ¿ç¶“æ¿ŸæŒ‡æ¨™è®ŠåŒ–...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="time-display">
                    è·é›¢å­£åº¦çµæŸï¼š<span id="timeRemaining">0:30</span>
                </div>
            </div>

            <div class="game-board">
                <!-- å·¦å´é¢æ¿ï¼šåœ‹å®¶æŠ€èƒ½ç³»çµ± -->
                <div class="panel">
                    <h2>ğŸ¯ åœ‹å®¶æŠ€èƒ½ç³»çµ±</h2>
                    
                    <div class="skill-card" id="skillCard">
                        <div class="skill-header">
                            <span class="skill-icon" id="skillIcon">âš”ï¸</span>
                            <div class="skill-details">
                                <div class="skill-name" id="skillName">ç¶“æ¿Ÿåˆ¶è£</div>
                                <div class="skill-cooldown" id="skillCooldown">æº–å‚™å°±ç·’</div>
                            </div>
                        </div>
                        <div class="skill-description" id="skillDescription">
                            å°æŒ‡å®šåœ‹å®¶å¯¦æ–½åš´å²ç¶“æ¿Ÿåˆ¶è£ï¼Œé€ æˆæŒçºŒ2å­£çš„é¡¯è‘—è² é¢å½±éŸ¿ï¼Œä½†æœ‰35%æ©Ÿç‡åå™¬è‡ªèº«
                        </div>
                        <div class="skill-controls" id="skillControls">
                            <select id="targetCountry" class="target-selector">
                                <option value="CHN">ğŸ‡¨ğŸ‡³ ä¸­åœ‹</option>
                                <option value="JPN">ğŸ‡¯ğŸ‡µ æ—¥æœ¬</option>
                            </select>
                            <button class="btn-skill" id="useSkillBtn">ç™¼å‹•æŠ€èƒ½</button>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn-primary" id="implementBtn">å¯¦æ–½æ”¿ç­–</button>
                        <button class="btn-danger" id="pauseBtn">æš«åœéŠæˆ²</button>
                    </div>
                </div>

                <!-- å³å´é¢æ¿ï¼šè²¨å¹£æ”¿ç­–å·¥å…· -->
                <div class="panel">
                    <h2>ğŸ”§ è²¨å¹£æ”¿ç­–å·¥å…·</h2>
                    
                    <div class="policy-tools">
                        <div class="tool-group">
                            <h3>åˆ©ç‡æ”¿ç­–</h3>
                            <div class="tool-controls">
                                <label>åŸºæº–åˆ©ç‡</label>
                                <input type="range" id="interestRate" min="0" max="10" step="0.25" value="2.5">
                                <span class="value-display" id="interestRateValue">2.5%</span>
                            </div>
                        </div>

                        <div class="tool-group">
                            <h3>è²¨å¹£ä¾›çµ¦</h3>
                            <div class="tool-controls">
                                <label>å­˜æ¬¾æº–å‚™é‡‘ç‡</label>
                                <input type="range" id="reserveRatio" min="5" max="25" step="1" value="10">
                                <span class="value-display" id="reserveRatioValue">10%</span>
                            </div>
                        </div>

                        <div class="tool-group">
                            <h3>è²¡æ”¿æ”¿ç­–</h3>
                            <div class="fiscal-controls">
                                <button class="btn-fiscal" id="increaseSpendingBtn">ğŸ“ˆ å¢åŠ æ”¿åºœæ”¯å‡º</button>
                                <button class="btn-fiscal decrease" id="decreaseSpendingBtn">ğŸ“‰ æ¸›å°‘æ”¿åºœæ”¯å‡º</button>
                            </div>
                            <div class="fiscal-status">
                                ç•¶å‰æ”¯å‡ºæ°´å¹³: <span id="spendingLevelDisplay">ä¸­æ€§</span>
                            </div>
                            <button class="btn-emergency" id="emergencyBtn" style="display: none;">ğŸš¨ ç·Šæ€¥è²¡æ”¿åˆºæ¿€</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- äº‹ä»¶æ—¥èªŒ -->
            <div class="events-log">
                <h3>ğŸ“¢ å¤®è¡Œå…¬å‘Šèˆ‡å¸‚å ´å‹•æ…‹</h3>
                <div id="eventsContainer">
                    <div class="event-item">
                        <strong>[å­£åº¦1]</strong> æ­¡è¿ä¾†åˆ°å…¨çƒå¤®è¡Œæ¨¡æ“¬å™¨ï¼èª¿æ•´æ”¿ç­–å·¥å…·å³æ™‚å½±éŸ¿ç¶“æ¿ŸæŒ‡æ¨™è®ŠåŒ–ã€‚
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€è®Šé‡
        let gameState;
        let updateTimer;
        let selectedCountry = null;

        // åœ‹å®¶é…ç½®
        const countryConfigs = {
            USA: {
                name: 'ç¾åœ‹',
                flag: 'ğŸ‡ºğŸ‡¸',
                skill: {
                    name: 'ç¶“æ¿Ÿåˆ¶è£',
                    icon: 'âš”ï¸',
                    description: 'å°æŒ‡å®šåœ‹å®¶å¯¦æ–½åš´å²ç¶“æ¿Ÿåˆ¶è£ï¼Œé€ æˆæŒçºŒ2å­£çš„é¡¯è‘—è² é¢å½±éŸ¿ï¼Œä½†æœ‰35%æ©Ÿç‡åå™¬è‡ªèº«',
                    cooldown: 4,
                    hasTarget: true
                },
                indicators: ['gdp', 'inflation', 'unemployment', 'confidence', 'deficit'],
                startingValues: {
                    gdp: 2.5, inflation: 3.2, unemployment: 5.1, 
                    confidence: 80, fiscalDeficit: 2.1
                }
            },
            CHN: {
                name: 'ä¸­åœ‹',
                flag: 'ğŸ‡¨ğŸ‡³',
                skill: {
                    name: 'ç§‘æŠ€çªç ´',
                    icon: 'ğŸš€',
                    description: 'é›†ä¸­åŠ›é‡è¾¦å¤§äº‹ï¼Œå¯¦ç¾é‡å¤§ç§‘æŠ€çªç ´ï¼Œå¤§å¹…æå‡GDPæˆé•·ï¼Œå¸¶å‹•å…¨çƒæŠ€è¡“é€²æ­¥',
                    cooldown: 5,
                    hasTarget: false
                },
                indicators: ['gdp', 'inflation', 'unemployment', 'confidence', 'deficit'],
                startingValues: {
                    gdp: 5.2, inflation: 2.1, unemployment: 4.2, 
                    confidence: 80, fiscalDeficit: 1.8
                }
            },
            JPN: {
                name: 'æ—¥æœ¬',
                flag: 'ğŸ‡¯ğŸ‡µ',
                skill: {
                    name: 'æ”¹å–„è€äººå°±æ¥­å•é¡Œ',
                    icon: 'ğŸ‘´',
                    description: 'é€éæ•¸ä½åŒ–åŸ¹è¨“å’Œå½ˆæ€§å·¥ä½œåˆ¶åº¦ï¼Œæå‡é«˜é½¡å‹å‹•åƒèˆ‡ç‡ï¼Œè§£æ±ºé€šç¸®å’Œä¿¡å¿ƒå•é¡Œ',
                    cooldown: 5,
                    hasTarget: false
                },
                indicators: ['gdp', 'inflation', 'unemployment', 'confidence', 'deficit'],
                startingValues: {
                    gdp: 1.8, inflation: 1.2, unemployment: 2.8, 
                    confidence: 70, fiscalDeficit: 4.0
                }
            }
        };

        // ===== åœ‹å®¶é¸æ“‡åŠŸèƒ½ =====
        function setupCountrySelection() {
            const countryCards = document.querySelectorAll('.country-card');
            const startBtn = document.getElementById('startGameBtn');

            countryCards.forEach(card => {
                card.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰é¸ä¸­ç‹€æ…‹
                    countryCards.forEach(c => c.classList.remove('selected'));
                    
                    // æ·»åŠ é¸ä¸­ç‹€æ…‹
                    this.classList.add('selected');
                    selectedCountry = this.getAttribute('data-country');
                    
                    // å•Ÿç”¨é–‹å§‹æŒ‰éˆ•
                    startBtn.disabled = false;
                });
            });

            startBtn.addEventListener('click', function() {
                if (selectedCountry) {
                    startGame();
                }
            });
        }

        function startGame() {
            // éš±è—é¸æ“‡ç•Œé¢ï¼Œé¡¯ç¤ºéŠæˆ²ç•Œé¢
            document.getElementById('countrySelection').style.display = 'none';
            document.getElementById('gameContent').style.display = 'block';
            
            // åˆå§‹åŒ–éŠæˆ²
            initGame();
        }

        // ===== æ ¸å¿ƒéŠæˆ²åŠŸèƒ½å‡½æ•¸ =====
        function initGame() {
            console.log('ğŸ® é–‹å§‹åˆå§‹åŒ–éŠæˆ²...');
            
            const config = countryConfigs[selectedCountry];
            
            // åˆå§‹åŒ–éŠæˆ²ç‹€æ…‹
            gameState = {
                currentQuarter: 1,
                quarterProgress: 0,
                quarterDuration: 30000, // 30ç§’ä¸€å­£
                isGamePaused: false,
                lastUpdateTime: Date.now(),
                recessionRisk: false,
                playerCountry: selectedCountry,
                countries: {}
            };

            // åˆå§‹åŒ–æ‰€æœ‰åœ‹å®¶
            Object.keys(countryConfigs).forEach(countryCode => {
                const countryConfig = countryConfigs[countryCode];
                gameState.countries[countryCode] = {
                    name: countryConfig.name,
                    ...countryConfig.startingValues,
                    govSpendingLevel: 0,
                    interestRate: countryCode === 'USA' ? 2.5 : countryCode === 'CHN' ? 3.8 : 0.1,
                    reserveRatio: 10,
                    gdpTrend: 0,
                    inflationTrend: 0,
                    unemploymentTrend: 0,
                    skillCooldown: 0,
                    policyCooldown: 0,
                    previousCrisisLevel: 'stable',
                    emergencyUsed: false
                };
            });

            updateCountryDisplay();
            setupEventListeners();
            updateInternationalDashboard();
            updateSkillDisplay();
            updatePolicyCooldownDisplay();
            updateSpendingLevelDisplay();
            updateEmergencyToolDisplay();
            
            // å•Ÿå‹•éŠæˆ²å¾ªç’°
            updateTimer = setInterval(gameLoop, 100);
            
            // æ­¡è¿è¨Šæ¯
            setTimeout(() => {
                showNewsAlert('éŠæˆ²é–‹å§‹', `ğŸ® æ­¡è¿ä¾†åˆ°å…¨çƒå¤®è¡Œæ¨¡æ“¬å™¨ï¼ä½ ç¾åœ¨æ˜¯${config.name}å¤®è¡Œè¡Œé•·ï¼`, 'quarter-report');
            }, 1000);
            
            console.log('âœ… éŠæˆ²åˆå§‹åŒ–å®Œæˆï¼');
        }

        function gameLoop() {
            if (!gameState.isGamePaused) {
                updateQuarterProgress();
                updateEconomicIndicators();
                updatePolicyCooldown();
            }
        }

        function setupEventListeners() {
            console.log('ğŸ“¡ è¨­ç½®äº‹ä»¶ç›£è½å™¨...');
            
            // æ»‘å¡Šäº‹ä»¶
            const interestRateSlider = document.getElementById('interestRate');
            if (interestRateSlider) {
                interestRateSlider.addEventListener('input', function() {
                    document.getElementById('interestRateValue').textContent = this.value + '%';
                });
            }

            const reserveRatioSlider = document.getElementById('reserveRatio');
            if (reserveRatioSlider) {
                reserveRatioSlider.addEventListener('input', function() {
                    document.getElementById('reserveRatioValue').textContent = this.value + '%';
                });
            }

            // æŒ‰éˆ•äº‹ä»¶
            document.getElementById('implementBtn').addEventListener('click', implementPolicy);
            document.getElementById('pauseBtn').addEventListener('click', togglePause);
            document.getElementById('useSkillBtn').addEventListener('click', useSkill);
            document.getElementById('closeAlertBtn').addEventListener('click', closeNewsAlert);
            document.getElementById('increaseSpendingBtn').addEventListener('click', increaseGovernmentSpending);
            document.getElementById('decreaseSpendingBtn').addEventListener('click', decreaseGovernmentSpending);
            document.getElementById('emergencyBtn').addEventListener('click', emergencyFiscalStimulus);
            
            console.log('âœ… äº‹ä»¶ç›£è½å™¨è¨­ç½®å®Œæˆ');
        }

        // ===== æŠ€èƒ½ç³»çµ± =====
        function useSkill() {
            const playerCountry = gameState.countries[selectedCountry];
            
            if (playerCountry.skillCooldown > 0) {
                showNewsAlert('æŠ€èƒ½å†·å»', `æŠ€èƒ½é‚„åœ¨å†·å»ä¸­ï¼Œè«‹ç­‰å¾… ${playerCountry.skillCooldown} å­£`, 'warning');
                return;
            }
            
            const config = countryConfigs[selectedCountry];
            
            // æ ¹æ“šåœ‹å®¶åŸ·è¡Œä¸åŒæŠ€èƒ½
            switch(selectedCountry) {
                case 'USA':
                    executeUSASkill();
                    break;
                case 'CHN':
                    executeCHNSkill();
                    break;
                case 'JPN':
                    executeJPNSkill();
                    break;
            }
            
            playerCountry.skillCooldown = config.skill.cooldown;
            updateSkillDisplay();
        }

        function executeUSASkill() {
            const usa = gameState.countries['USA'];
            const targetCountryCode = document.getElementById('targetCountry').value;
            const targetCountry = gameState.countries[targetCountryCode];
            
            // å°ç›®æ¨™åœ‹å®¶çš„å¼·åŒ–å½±éŸ¿ï¼ˆæŒçºŒ2å­£ï¼‰
            targetCountry.gdpTrend -= 3.0;
            targetCountry.inflationTrend += 2.0;
            targetCountry.unemploymentTrend += 1.5;
            targetCountry.confidence -= 15;
            
            // æ·»åŠ åˆ¶è£ç‹€æ…‹æ¨™è¨˜ï¼ˆæŒçºŒ2å­£ï¼‰
            targetCountry.sanctionDuration = 2;
            targetCountry.sanctionEffect = {
                gdpTrend: -1.5,
                inflationTrend: 1.0,
                unemploymentTrend: 0.8
            };
            
            // 35%æ©Ÿç‡åå™¬
            const hasBacklash = Math.random() < 0.35;
            
            if (hasBacklash) {
                usa.inflationTrend += 0.8;
                usa.gdpTrend -= 0.5;
                usa.confidence -= 3;
                
                showNewsAlert('åˆ¶è£åå™¬', `ğŸ”¥ ç¶“æ¿Ÿåˆ¶è£å°ç¾åœ‹ç¶“æ¿Ÿé€ æˆåå™¬ï¼åœ‹å…§é€šè†¨ä¸Šå‡ï¼Œç¶“æ¿Ÿå—æ`, 'warning');
                addEvent(`[æŠ€èƒ½åå™¬] ç¾åœ‹å°${targetCountry.name}å¯¦æ–½åˆ¶è£ï¼Œä½†åœ‹å…§ç¶“æ¿Ÿä¹Ÿå—åˆ°è¡æ“Š`, 'policy-change');
            } else {
                usa.confidence += 2;
                
                showNewsAlert('åˆ¶è£æˆåŠŸ', `âš”ï¸ ç¾åœ‹æˆåŠŸåˆ¶è£${targetCountry.name}ï¼Œåœ‹å…§æ°‘çœ¾æ”¯æŒå¼·ç¡¬æ…‹åº¦`, 'economic-alert');
                addEvent(`[æŠ€èƒ½æˆåŠŸ] ç¾åœ‹å°${targetCountry.name}å¯¦æ–½åš´å²åˆ¶è£ï¼ŒæˆåŠŸé¿å…åœ‹å…§é‡å¤§æå¤±`, 'policy-change');
            }
            
            showNewsAlert('ç¶“æ¿Ÿåˆ¶è£', `ğŸ‡ºğŸ‡¸ ç¾åœ‹å°${targetCountry.name}å¯¦æ–½å…¨é¢ç¶“æ¿Ÿåˆ¶è£ï¼`, 'economic-alert');
        }

        function executeCHNSkill() {
            const chn = gameState.countries['CHN'];
            
            // ç«‹å³æ•ˆæœ
            chn.gdp += 2.5;
            chn.unemployment -= 1.0;
            
            // æŒçºŒè¶¨å‹¢æ•ˆæœ
            chn.gdpTrend += 2.0;
            chn.unemploymentTrend -= 0.8;
            chn.inflationTrend += 0.3; // è¼•å¾®é€šè†¨å£“åŠ›
            
            // å…¨çƒæ­£é¢æº¢å‡ºæ•ˆæ‡‰
            for (let code of ['USA', 'JPN']) {
                if (code !== selectedCountry) {
                    gameState.countries[code].gdpTrend += 0.3;
                    gameState.countries[code].confidence += 3;
                }
            }
            
            showNewsAlert('ç§‘æŠ€çªç ´', `ğŸš€ ä¸­åœ‹å¯¦ç¾é‡å¤§ç§‘æŠ€çªç ´ï¼æ–°èˆˆç”¢æ¥­çˆ†ç™¼å¼ç™¼å±•`, 'quarter-report');
            addEvent(`[ç§‘æŠ€çªç ´] ä¸­åœ‹é›†ä¸­åŠ›é‡å¯¦ç¾é—œéµæŠ€è¡“çªç ´ï¼ŒGDPå¤§å¹…æå‡`, 'policy-change');
        }

        function executeJPNSkill() {
            const jpn = gameState.countries['JPN'];
            
            // ç«‹å³æ•ˆæœï¼ˆå¢å¼·ï¼‰
            jpn.inflation += 1.8;     // å¾1.2æé«˜åˆ°1.8ï¼Œå°æŠ—é€šç¸®
            jpn.confidence += 25;     // å¾18æé«˜åˆ°25ï¼Œå¤§å¹…æå‡ç¤¾æœƒä¿¡å¿ƒ
            jpn.gdp += 1.2;          // å¾0.8æé«˜åˆ°1.2ï¼Œæ›´é¡¯è‘—çš„ç¶“æ¿Ÿæå‡
            jpn.unemployment -= 0.8;  // å¾0.5æé«˜åˆ°0.8ï¼Œå°±æ¥­æ”¹å–„
            jpn.fiscalDeficit += 0.8; // æ”¹é©æˆæœ¬ç¶­æŒä¸è®Š
            
            // æŒçºŒè¶¨å‹¢æ•ˆæœï¼ˆå¢å¼·ï¼‰
            jpn.inflationTrend += 1.2; // å¾0.8æé«˜åˆ°1.2
            jpn.gdpTrend += 0.8;      // å¾0.5æé«˜åˆ°0.8
            
            // ç‰¹æ®Šæ•ˆæœï¼š3å­£å…§æ”¿ç­–æ•ˆæœç¿»å€
            jpn.policyBoostDuration = 3;
            
            showNewsAlert('å°±æ¥­æ”¹é©', `ğŸ‘´ æ—¥æœ¬æ¨å‹•é«˜é½¡å°±æ¥­æ”¹é©ï¼é€šç¸®å£“åŠ›å¤§å¹…ç·©è§£ï¼Œç¤¾æœƒä¿¡å¿ƒç©ºå‰æå‡`, 'quarter-report');
            addEvent(`[æ”¹å–„è€äººå°±æ¥­å•é¡Œ] æ—¥æœ¬æ¨å‹•æ•¸ä½åŒ–åŸ¹è¨“ï¼Œé«˜é½¡å‹å‹•åƒèˆ‡ç‡å¤§å¹…æå‡ï¼Œæ”¿ç­–æ•ˆæœå¢å¼·3å­£`, 'policy-change');
        }

        // ===== åˆ¶è£æ•ˆæœæŒçºŒç³»çµ± =====
        function updateSanctionEffects() {
            for (let countryCode in gameState.countries) {
                const country = gameState.countries[countryCode];
                
                if (country.sanctionDuration > 0) {
                    // æ‡‰ç”¨åˆ¶è£æ•ˆæœ
                    country.gdpTrend += country.sanctionEffect.gdpTrend;
                    country.inflationTrend += country.sanctionEffect.inflationTrend;
                    country.unemploymentTrend += country.sanctionEffect.unemploymentTrend;
                    
                    country.sanctionDuration--;
                    
                    if (country.sanctionDuration === 0) {
                        addEvent(`[åˆ¶è£çµæŸ] ${country.name}çš„åˆ¶è£æ•ˆæœé€æ¼¸æ¶ˆé€€`, 'quarter-end');
                        delete country.sanctionEffect;
                    }
                }
            }
        }

        // ===== ç•Œé¢æ›´æ–°åŠŸèƒ½ =====
        function updateCountryDisplay() {
            const config = countryConfigs[selectedCountry];
            
            // æ›´æ–°æ¨™é¡Œ
            document.getElementById('gameTitle').innerHTML = `ğŸ¦ å…¨çƒå¤®è¡Œæ¨¡æ“¬å™¨ - ${config.name}`;
            
            // å‹•æ…‹ç”Ÿæˆåœ‹éš›ç¶“æ¿Ÿå„€è¡¨æ¿
            generateInternationalDashboard();
            
            // æ›´æ–°ç•¶å‰åœ‹å®¶æŒ‡æ¨™
            updateCurrentCountryIndicators();
            
            // æ›´æ–°æŠ€èƒ½é¡¯ç¤º
            updateSkillDisplay();
        }

        function generateInternationalDashboard() {
            const dashboard = document.getElementById('internationalDashboard');
            dashboard.innerHTML = '';
            
            // ç²å–æ‰€æœ‰åœ‹å®¶ä»£ç¢¼ä¸¦æŒ‰é¸ä¸­åœ‹å®¶æ’åºï¼ˆé¸ä¸­åœ‹å®¶æ’ç¬¬ä¸€ï¼‰
            const allCountries = Object.keys(countryConfigs);
            const sortedCountries = [selectedCountry, ...allCountries.filter(code => code !== selectedCountry)];
            
            sortedCountries.forEach((countryCode, index) => {
                const config = countryConfigs[countryCode];
                const country = gameState.countries[countryCode];
                const isPlayer = countryCode === selectedCountry;
                
                const panelDiv = document.createElement('div');
                panelDiv.className = `country-panel ${isPlayer ? 'current-country' : countryCode.toLowerCase()}`;
                panelDiv.id = `${countryCode.toLowerCase()}CountryPanel`;
                
                // åœ‹å®¶é ­éƒ¨
                const headerDiv = document.createElement('div');
                headerDiv.className = 'country-header';
                headerDiv.innerHTML = `
                    <span class="country-flag">${config.flag}</span>
                    <span class="country-name">${config.name}</span>
                    <span class="country-status">${isPlayer ? 'ä½ æ§åˆ¶' : 'AIæ§åˆ¶'}</span>
                `;
                
                // æŒ‡æ¨™å€åŸŸ
                const indicatorsDiv = document.createElement('div');
                indicatorsDiv.className = isPlayer ? 'mini-indicators usa-indicators' : 'mini-indicators';
                indicatorsDiv.id = `${countryCode.toLowerCase()}CountryIndicators`;
                
                if (isPlayer) {
                    // ç©å®¶åœ‹å®¶é¡¯ç¤ºæ‰€æœ‰5å€‹æŒ‡æ¨™
                    const allIndicators = ['gdp', 'inflation', 'unemployment', 'confidence', 'deficit'];
                    allIndicators.forEach(indicator => {
                        const indicatorDiv = document.createElement('div');
                        indicatorDiv.className = 'mini-indicator';
                        indicatorDiv.id = `current-${indicator}-mini`;
                        
                        let label, value;
                        switch(indicator) {
                            case 'gdp':
                                label = 'GDPæˆé•·ç‡';
                                value = country.gdp.toFixed(1) + '%';
                                break;
                            case 'inflation':
                                label = 'é€šè†¨ç‡';
                                value = country.inflation.toFixed(1) + '%';
                                break;
                            case 'unemployment':
                                label = 'å¤±æ¥­ç‡';
                                value = country.unemployment.toFixed(1) + '%';
                                break;
                            case 'confidence':
                                label = 'æ°‘çœ¾ä¿¡å¿ƒ';
                                value = country.confidence.toFixed(0);
                                break;
                            case 'deficit':
                                label = 'è²¡æ”¿èµ¤å­—';
                                value = country.fiscalDeficit.toFixed(1) + '%';
                                break;
                        }
                        
                        indicatorDiv.innerHTML = `
                            <div class="mini-indicator-label">${label}</div>
                            <div class="mini-indicator-value" id="current-${indicator}-value">${value}</div>
                        `;
                        
                        indicatorsDiv.appendChild(indicatorDiv);
                    });
                    
                    // è²¡æ”¿èµ¤å­—æŒ‡æ¨™è·¨å…©åˆ—é¡¯ç¤º
                    const deficitIndicator = indicatorsDiv.querySelector('#current-deficit-mini');
                    if (deficitIndicator) {
                        deficitIndicator.style.gridColumn = '1 / 3';
                    }
                } else {
                    // AIåœ‹å®¶åªé¡¯ç¤ºéƒ¨åˆ†æŒ‡æ¨™
                    const publicIndicators = ['gdp', 'inflation', 'unemployment', 'confidence'];
                    publicIndicators.forEach(indicator => {
                        const indicatorDiv = document.createElement('div');
                        const isClassified = (indicator === 'unemployment' || indicator === 'confidence');
                        indicatorDiv.className = isClassified ? 'mini-indicator classified' : 'mini-indicator';
                        indicatorDiv.id = `${countryCode.toLowerCase()}-${indicator}-mini`;
                        
                        let label, value;
                        switch(indicator) {
                            case 'gdp':
                                label = 'GDPæˆé•·ç‡';
                                value = country.gdp.toFixed(1) + '%';
                                break;
                            case 'inflation':
                                label = 'é€šè†¨ç‡';
                                value = country.inflation.toFixed(1) + '%';
                                break;
                            case 'unemployment':
                                label = 'å¤±æ¥­ç‡';
                                value = 'æ©Ÿå¯†';
                                break;
                            case 'confidence':
                                label = 'æ°‘çœ¾ä¿¡å¿ƒ';
                                value = 'æ©Ÿå¯†';
                                break;
                        }
                        
                        indicatorDiv.innerHTML = `
                            <div class="mini-indicator-label">${label}</div>
                            <div class="mini-indicator-value" id="${countryCode.toLowerCase()}-${indicator}-value-mini">${value}</div>
                        `;
                        
                        indicatorsDiv.appendChild(indicatorDiv);
                    });
                }
                
                panelDiv.appendChild(headerDiv);
                panelDiv.appendChild(indicatorsDiv);
                dashboard.appendChild(panelDiv);
            });
        }

        function updateCurrentCountryIndicators() {
            // é€™å€‹å‡½æ•¸ç¾åœ¨ç”± generateInternationalDashboard è™•ç†
            // ä¿ç•™ç©ºå‡½æ•¸ä»¥é¿å…éŒ¯èª¤
        }

        function updateCurrentCountryIndicatorColors() {
            const country = gameState.countries[selectedCountry];
            
            // GDPæŒ‡æ¨™é¡è‰²
            const gdpElement = document.getElementById('current-gdp-mini');
            if (gdpElement) {
                if (country.gdp >= 3) {
                    gdpElement.className = 'mini-indicator good';
                } else if (country.gdp >= 1) {
                    gdpElement.className = 'mini-indicator warning';
                } else {
                    gdpElement.className = 'mini-indicator danger';
                }
            }

            // é€šè†¨æŒ‡æ¨™é¡è‰²
            const inflationElement = document.getElementById('current-inflation-mini');
            if (inflationElement) {
                if (country.inflation >= 1.5 && country.inflation <= 3.5) {
                    inflationElement.className = 'mini-indicator good';
                } else if (country.inflation >= 0.5 && country.inflation <= 5) {
                    inflationElement.className = 'mini-indicator warning';
                } else {
                    inflationElement.className = 'mini-indicator danger';
                }
            }

            // å¤±æ¥­ç‡æŒ‡æ¨™é¡è‰²
            const unemploymentElement = document.getElementById('current-unemployment-mini');
            if (unemploymentElement) {
                if (country.unemployment <= 5) {
                    unemploymentElement.className = 'mini-indicator good';
                } else if (country.unemployment <= 8) {
                    unemploymentElement.className = 'mini-indicator warning';
                } else {
                    unemploymentElement.className = 'mini-indicator danger';
                }
            }

            // æ°‘çœ¾ä¿¡å¿ƒæŒ‡æ¨™é¡è‰²
            const confidenceElement = document.getElementById('current-confidence-mini');
            if (confidenceElement) {
                if (country.confidence >= 70) {
                    confidenceElement.className = 'mini-indicator good';
                } else if (country.confidence >= 50) {
                    confidenceElement.className = 'mini-indicator warning';
                } else {
                    confidenceElement.className = 'mini-indicator danger';
                }
            }

            // è²¡æ”¿èµ¤å­—æŒ‡æ¨™é¡è‰²
            const deficitElement = document.getElementById('current-deficit-mini');
            if (deficitElement) {
                if (country.fiscalDeficit > 8) {
                    deficitElement.className = 'mini-indicator danger';
                } else if (country.fiscalDeficit > 4) {
                    deficitElement.className = 'mini-indicator warning';
                } else {
                    deficitElement.className = 'mini-indicator good';
                }
            }
        }

        function updateSkillDisplay() {
            const config = countryConfigs[selectedCountry];
            const country = gameState.countries[selectedCountry];
            
            // æ›´æ–°æŠ€èƒ½ä¿¡æ¯
            document.getElementById('skillIcon').textContent = config.skill.icon;
            document.getElementById('skillName').textContent = config.skill.name;
            document.getElementById('skillDescription').textContent = config.skill.description;
            
            // æ›´æ–°å†·å»ç‹€æ…‹
            const skillCard = document.getElementById('skillCard');
            const cooldownElement = document.getElementById('skillCooldown');
            const useSkillBtn = document.getElementById('useSkillBtn');
            const skillControls = document.getElementById('skillControls');
            
            if (country.skillCooldown === 0) {
                skillCard.className = 'skill-card ready';
                cooldownElement.textContent = 'æº–å‚™å°±ç·’';
                cooldownElement.className = 'skill-cooldown ready';
                useSkillBtn.disabled = false;
                useSkillBtn.textContent = 'ç™¼å‹•æŠ€èƒ½';
            } else {
                skillCard.className = 'skill-card cooldown';
                cooldownElement.textContent = 'å†·å»ä¸­ (' + country.skillCooldown + 'å­£)';
                cooldownElement.className = 'skill-cooldown on-cooldown';
                useSkillBtn.disabled = true;
                useSkillBtn.textContent = 'å†·å»ä¸­';
            }
            
            // æ›´æ–°ç›®æ¨™é¸æ“‡å™¨
            const targetSelector = document.getElementById('targetCountry');
            if (config.skill.hasTarget) {
                skillControls.style.display = 'flex';
                // æ¸…ç©ºä¸¦é‡æ–°å¡«å……é¸é …
                targetSelector.innerHTML = '';
                
                Object.keys(countryConfigs).forEach(code => {
                    if (code !== selectedCountry) {
                        const option = document.createElement('option');
                        option.value = code;
                        option.textContent = `${countryConfigs[code].flag} ${countryConfigs[code].name}`;
                        targetSelector.appendChild(option);
                    }
                });
            } else {
                skillControls.innerHTML = `<button class="btn-skill" id="useSkillBtn">${useSkillBtn.textContent}</button>`;
                // é‡æ–°ç¶å®šäº‹ä»¶
                document.getElementById('useSkillBtn').addEventListener('click', useSkill);
            }
        }

        function updateOtherCountriesDisplay() {
            // æ›´æ–°æ‰€æœ‰AIåœ‹å®¶çš„å…¬é–‹æŒ‡æ¨™
            Object.keys(countryConfigs).forEach(countryCode => {
                if (countryCode !== selectedCountry) {
                    const country = gameState.countries[countryCode];
                    const gdpElement = document.getElementById(`${countryCode.toLowerCase()}-gdp-value-mini`);
                    const inflationElement = document.getElementById(`${countryCode.toLowerCase()}-inflation-value-mini`);
                    
                    if (gdpElement) gdpElement.textContent = country.gdp.toFixed(1) + '%';
                    if (inflationElement) inflationElement.textContent = country.inflation.toFixed(1) + '%';
                }
            });
            
            updateMiniIndicatorColors();
        }

        // ===== ä¿®æ”¹åŸæœ‰å‡½æ•¸ä»¥é©æ‡‰å¤šåœ‹ç³»çµ± =====
        function updateInternationalDashboard() {
            // æ›´æ–°ç•¶å‰ç©å®¶åœ‹å®¶çš„æ‰€æœ‰5å€‹æŒ‡æ¨™æ•¸å€¼
            const playerCountry = gameState.countries[selectedCountry];
            const allIndicators = ['gdp', 'inflation', 'unemployment', 'confidence', 'deficit'];
            
            allIndicators.forEach(indicator => {
                const valueElement = document.getElementById(`current-${indicator}-value`);
                if (valueElement) {
                    let value;
                    switch(indicator) {
                        case 'gdp':
                            value = playerCountry.gdp.toFixed(1) + '%';
                            break;
                        case 'inflation':
                            value = playerCountry.inflation.toFixed(1) + '%';
                            break;
                        case 'unemployment':
                            value = playerCountry.unemployment.toFixed(1) + '%';
                            break;
                        case 'confidence':
                            value = playerCountry.confidence.toFixed(0);
                            break;
                        case 'deficit':
                            value = playerCountry.fiscalDeficit.toFixed(1) + '%';
                            break;
                    }
                    valueElement.textContent = value;
                }
            });
            
            // æ›´æ–°å…¶ä»–åœ‹å®¶é¡¯ç¤º
            updateOtherCountriesDisplay();
            updateCurrentCountryIndicatorColors();
        }

        function updateMiniIndicatorColors() {
            // æ›´æ–°æ‰€æœ‰åœ‹å®¶çš„æŒ‡æ¨™é¡è‰²
            Object.keys(countryConfigs).forEach(countryCode => {
                const country = gameState.countries[countryCode];
                const prefix = countryCode === selectedCountry ? 'current' : countryCode.toLowerCase();
                
                const gdpElement = document.getElementById(`${prefix}-gdp-mini`);
                if (gdpElement) {
                    if (country.gdp >= 3) {
                        gdpElement.className = 'mini-indicator good';
                    } else if (country.gdp >= 1) {
                        gdpElement.className = 'mini-indicator warning';
                    } else {
                        gdpElement.className = 'mini-indicator danger';
                    }
                }

                const inflationElement = document.getElementById(`${prefix}-inflation-mini`);
                if (inflationElement) {
                    if (country.inflation >= 1.5 && country.inflation <= 3.5) {
                        inflationElement.className = 'mini-indicator good';
                    } else if (country.inflation >= 0.5 && country.inflation <= 5) {
                        inflationElement.className = 'mini-indicator warning';
                    } else {
                        inflationElement.className = 'mini-indicator danger';
                    }
                }
                
                // åªç‚ºç©å®¶åœ‹å®¶æ›´æ–°é¡å¤–æŒ‡æ¨™é¡è‰²
                if (countryCode === selectedCountry) {
                    const unemploymentElement = document.getElementById(`${prefix}-unemployment-mini`);
                    if (unemploymentElement) {
                        if (country.unemployment <= 5) {
                            unemploymentElement.className = 'mini-indicator good';
                        } else if (country.unemployment <= 8) {
                            unemploymentElement.className = 'mini-indicator warning';
                        } else {
                            unemploymentElement.className = 'mini-indicator danger';
                        }
                    }

                    const confidenceElement = document.getElementById(`${prefix}-confidence-mini`);
                    if (confidenceElement) {
                        if (country.confidence >= 70) {
                            confidenceElement.className = 'mini-indicator good';
                        } else if (country.confidence >= 50) {
                            confidenceElement.className = 'mini-indicator warning';
                        } else {
                            confidenceElement.className = 'mini-indicator danger';
                        }
                    }

                    const deficitElement = document.getElementById(`${prefix}-deficit-mini`);
                    if (deficitElement) {
                        if (country.fiscalDeficit > 8) {
                            deficitElement.className = 'mini-indicator danger';
                        } else if (country.fiscalDeficit > 4) {
                            deficitElement.className = 'mini-indicator warning';
                        } else {
                            deficitElement.className = 'mini-indicator good';
                        }
                    }
                }
            });
        }

        function endQuarter() {
            gameState.quarterProgress = 0;
            gameState.currentQuarter++;
            
            // æ—¥æœ¬ç²¾å¯†è£½é€ æ¯å­£çå‹µ
            updateJapanQuarterlyBonus();
            
            // æ›´æ–°æŠ€èƒ½å†·å»
            for (let countryCode in gameState.countries) {
                const country = gameState.countries[countryCode];
                if (country.skillCooldown > 0) {
                    country.skillCooldown--;
                }
            }
            
            // æ›´æ–°åˆ¶è£æ•ˆæœ
            updateSanctionEffects();
            
            updateSkillDisplay();

            const quarterElement = document.getElementById('currentQuarter');
            if (quarterElement) quarterElement.textContent = gameState.currentQuarter;

            // çªç™¼äº‹ä»¶æ©Ÿç‡
            let eventProbability = 0.6;
            
            const playerCountry = gameState.countries[selectedCountry];
            if (playerCountry.inflation > 6 || playerCountry.gdp < 0 || playerCountry.unemployment > 8 || playerCountry.confidence < 50) {
                eventProbability = 0.8;
                addEvent('[ç¶“æ¿Ÿé è­¦] ç¶“æ¿Ÿä¸ç©©å®šï¼Œçªç™¼äº‹ä»¶é¢¨éšªä¸Šå‡', 'quarter-end');
            }
            
            if (Math.random() < eventProbability) {
                triggerRandomEvent();
            }

            addEvent('[å­£åº¦çµæŸ] ç¬¬' + (gameState.currentQuarter-1) + 'å­£çµæœ', 'quarter-end');

            // æ¯4å­£é¡¯ç¤ºå¹´åº¦å ±å‘Š
            if ((gameState.currentQuarter - 1) % 4 === 0 && gameState.currentQuarter > 1) {
                setTimeout(showYearlyReport, 1000);
            }
        }

        // æ—¥æœ¬æ¯å­£åº¦ç²¾å¯†è£½é€ çå‹µï¼ˆå¢å¼·ï¼‰
        function updateJapanQuarterlyBonus() {
            if (selectedCountry === 'JPN') {
                const jpn = gameState.countries['JPN'];
                jpn.gdp += 0.15; // å¾0.1æé«˜åˆ°0.15
                jpn.confidence += 2; // å¾1æé«˜åˆ°2
                jpn.inflation += 0.05; // æ–°å¢ï¼šè¼•å¾®é€šè†¨æ¨å‹•
                
                // æª¢æŸ¥æ”¿ç­–åŠ æˆæœŸé–“
                if (jpn.policyBoostDuration > 0) {
                    jpn.policyBoostDuration--;
                    jpn.gdp += 0.1; // é¡å¤–çå‹µ
                    jpn.inflation += 0.1; // é¡å¤–é€šè†¨æ¨å‹•
                    addEvent('[æ”¿ç­–åŠ æˆ] æ—¥æœ¬å°±æ¥­æ”¹é©æ•ˆæœæŒçºŒç™¼æ®ï¼Œç¶“æ¿ŸæŒçºŒæ”¹å–„', 'quarter-end');
                }
                
                addEvent('[ç²¾å¯†è£½é€ ] æ—¥æœ¬è£½é€ æ¥­æŒçºŒæŠ€è¡“é€²æ­¥ï¼Œç¶“æ¿Ÿç©©å®šæå‡', 'quarter-end');
            }
        }

        function showYearlyReport() {
            gameState.isGamePaused = true;
            
            const reportDiv = document.createElement('div');
            reportDiv.id = 'yearlyReport';
            reportDiv.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; align-items: center; justify-content: center;';

            const currentYear = Math.floor((gameState.currentQuarter - 1) / 4);
            const playerCountry = gameState.countries[selectedCountry];
            const config = countryConfigs[selectedCountry];
            
            reportDiv.innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 40px; max-width: 600px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <h1 style="color: #2c3e50; margin-bottom: 20px;">ğŸ† ${config.name}ç¬¬${currentYear}å¹´åº¦å ±å‘Š</h1>
                    <div style="margin: 20px 0;">
                        <h3>${config.name}ç¶“æ¿Ÿè¡¨ç¾</h3>
                        <p>GDPæˆé•·ç‡: ${playerCountry.gdp.toFixed(1)}%</p>
                        <p>é€šè†¨ç‡: ${playerCountry.inflation.toFixed(1)}%</p>
                        <p>å¤±æ¥­ç‡: ${playerCountry.unemployment.toFixed(1)}%</p>
                        <p>æ°‘çœ¾ä¿¡å¿ƒ: ${playerCountry.confidence.toFixed(0)}</p>
                        <p>è²¡æ”¿èµ¤å­—: ${playerCountry.fiscalDeficit.toFixed(1)}%</p>
                    </div>
                    <div style="margin-top: 30px;">
                        <button id="continueBtn" style="background: #27ae60; color: white; border: none; padding: 15px 30px; border-radius: 10px; margin-right: 15px; cursor: pointer;">ğŸ¯ é€²å…¥ä¸‹ä¸€å¹´åº¦</button>
                        <button id="restartBtn" style="background: #3498db; color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer;">ğŸ”„ é‡æ–°é–‹å§‹</button>
                    </div>
                </div>
            `;

            document.body.appendChild(reportDiv);
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                continueToNextYear();
            });
            
            document.getElementById('restartBtn').addEventListener('click', function() {
                restartGame();
            });
        }

        // ===== ç¶“æ¿Ÿç³»çµ±å‡½æ•¸ =====
        function getCrisisLevel(country) {
            let crisisScore = 0;
            
            if (country.gdp < -3) crisisScore += 2;
            if (country.unemployment > 10) crisisScore += 2;
            if (country.confidence < 30) crisisScore += 2;
            if (country.inflation > 8 || country.inflation < -1) crisisScore += 1;
            if (country.fiscalDeficit > 15) crisisScore += 1;
            
            if (crisisScore >= 5) return 'severe';
            if (crisisScore >= 3) return 'moderate';
            if (crisisScore >= 1) return 'mild';
            return 'stable';
        }

        function getPolicyEffectMultiplier(country) {
            const crisisLevel = getCrisisLevel(country);
            
            switch(crisisLevel) {
                case 'severe':
                    return {
                        fiscal: 1.8,
                        monetary: 1.5,
                        message: 'å±æ©Ÿæ™‚æœŸï¼Œæ”¿ç­–å·¥å…·æ•ˆæœé¡¯è‘—å¢å¼·'
                    };
                case 'moderate':
                    return {
                        fiscal: 1.4,
                        monetary: 1.3,
                        message: 'ç¶“æ¿Ÿå›°é›£æœŸï¼Œæ”¿ç­–å‚³å°æ›´åŠ æœ‰æ•ˆ'
                    };
                case 'mild':
                    return {
                        fiscal: 1.2,
                        monetary: 1.1,
                        message: 'ç¶“æ¿Ÿä¸‹è¡ŒæœŸï¼Œæ”¿ç­–ç©ºé–“å……è£•'
                    };
                default:
                    return {
                        fiscal: 1.0,
                        monetary: 1.0,
                        message: ''
                    };
            }
        }

        function updateConfidence(country) {
            const updateRate = 0.1 / 1000;
            
            if (country.fiscalDeficit > 8) {
                country.confidence -= (country.fiscalDeficit - 8) * updateRate * 0.8;
            } else if (country.fiscalDeficit < -1) {
                country.confidence += updateRate * 0.3;
            }
            
            if (country.inflation > 4) {
                country.confidence -= (country.inflation - 4) * updateRate * 2;
            } else if (country.inflation >= 1.5 && country.inflation <= 3.5 && country.inflationTrend < 0) {
                country.confidence += updateRate * 4;
            }
            
            if (country.gdp > 1.5) {
                country.confidence += (country.gdp - 1.5) * updateRate * 2;
            } else if (country.gdp < 0) {
                country.confidence -= Math.abs(country.gdp) * updateRate * 1.5;
            }
            
            if (country.unemployment > 6) {
                country.confidence -= (country.unemployment - 6) * updateRate * 0.8;
            } else if (country.unemploymentTrend < -0.1) {
                country.confidence += updateRate * 3;
            }
            
            if (country.confidence < 40 && country.gdp > 0) {
                country.confidence += updateRate * 8;
            }
            
            country.confidence = Math.max(10, Math.min(100, country.confidence));
        }

        function updateEconomicIndicators() {
            for (let countryCode in gameState.countries) {
                const country = gameState.countries[countryCode];
                
                const updateRate = 0.5 / 1000;
                country.gdp += country.gdpTrend * updateRate;
                country.inflation += country.inflationTrend * updateRate;
                country.unemployment += country.unemploymentTrend * updateRate;

                // æ—¥æœ¬ç‰¹æ®Šæ©Ÿåˆ¶ï¼šæº«å’Œçš„é€šç¸®é«”è³ªï¼ˆå¤§å¹…èª¿æ•´ï¼‰
                if (countryCode === 'JPN') {
                    // åªæœ‰åœ¨é€šè†¨é«˜æ–¼3%æ™‚æ‰æœ‰ä¸‹é™è¶¨å‹¢
                    if (country.inflation > 3.0) {
                        country.inflationTrend -= 0.02;
                    } else if (country.inflation > 2.0) {
                        country.inflationTrend -= 0.005; // æ¥µè¼•å¾®ä¸‹é™
                    }
                    // é€šè†¨åœ¨0-2%ç¯„åœå…§æ™‚ï¼Œä¸å¼·åˆ¶ä¸‹é™
                    
                    // æ—¥æœ¬é€šç¸®é˜²è­·æ©Ÿåˆ¶
                    if (country.inflation < 0.5) {
                        country.inflationTrend += 0.01; // è‡ªç„¶å›å‡æ©Ÿåˆ¶
                        country.confidence += 0.2; // å¤®è¡Œä¿¡è­½åŠ æˆ
                    }
                }

                // é€šç¸®èºæ—‹æ©Ÿåˆ¶ï¼ˆèª¿æ•´å¾Œï¼‰
                updateDeflationEffect(country, countryCode);

                // GDPä½åŸºæœŸåå½ˆæ©Ÿåˆ¶
                if (country.gdp < -8) {
                    country.gdpTrend += 0.1;
                    
                    if (Math.random() < 0.003) {
                        showNewsAlert('æ”¿åºœç·Šæ€¥å¹²é ', 'ğŸš¨ åœ‹æœƒé€šéç·Šæ€¥ç¶“æ¿Ÿåˆºæ¿€æ³•æ¡ˆï¼', 'economic-alert');
                        addEvent('[è‡ªå‹•å¹²é ] æ”¿åºœå•Ÿå‹•ç·Šæ€¥ç¶“æ¿Ÿåˆºæ¿€è¨ˆåŠƒ');
                        country.gdpTrend += 0.8;
                        country.fiscalDeficit += 3;
                    }
                }

                // è²¡æ”¿èµ¤å­—è‡ªç„¶èª¿æ•´
                if (country.gdp > 0) {
                    country.fiscalDeficit -= country.gdp * updateRate * 0.2;
                }

                // åŠ å…¥éš¨æ©Ÿæ³¢å‹•
                const volatility = 0.005;
                country.gdp += (Math.random() - 0.5) * volatility;
                country.inflation += (Math.random() - 0.5) * volatility;
                country.unemployment += (Math.random() - 0.5) * volatility;

                // æ›´æ–°æ°‘çœ¾ä¿¡å¿ƒ
                updateConfidence(country);

                // é™åˆ¶ç¯„åœ
                country.gdp = Math.max(-10, Math.min(15, country.gdp));
                country.inflation = Math.max(-2, country.inflation);
                country.unemployment = Math.max(1, Math.min(25, country.unemployment));
                country.fiscalDeficit = Math.max(-5, Math.min(50, country.fiscalDeficit));
            }

            // åŸ·è¡Œè¢«å‹•æŠ€èƒ½
            updatePassiveSkills();

            updateInternationalDashboard();
            updateEmergencyToolDisplay();
        }

        // è¢«å‹•æŠ€èƒ½ç³»çµ±
        function updatePassiveSkills() {
            // ä¸­åœ‹è¢«å‹•ï¼šå•†æ¥­é–“è«œ
            updateChinaCommercialEspionage();
            
            // ç¾åœ‹è¢«å‹•ï¼šå…¨çƒå½±éŸ¿åŠ›
            updateUSAGlobalInfluence();
        }

        // ä¸­åœ‹è¢«å‹•æŠ€èƒ½ï¼šå•†æ¥­é–“è«œ
        function updateChinaCommercialEspionage() {
            const china = gameState.countries['CHN'];
            let hasGrowthBonus = false;
            
            // æª¢æŸ¥å…¶ä»–åœ‹å®¶çš„GDPæˆé•·
            Object.keys(gameState.countries).forEach(countryCode => {
                if (countryCode !== 'CHN') {
                    const otherCountry = gameState.countries[countryCode];
                    
                    // å¦‚æœå…¶ä»–åœ‹å®¶GDPè¶¨å‹¢ç‚ºæ­£ä¸”è¶…é1%
                    if (otherCountry.gdpTrend > 1.0) {
                        // 20%æ©Ÿç‡è§¸ç™¼å•†æ¥­é–“è«œæ•ˆæœ
                        if (Math.random() < 0.2) {
                            const espionageBonus = otherCountry.gdpTrend * 0.15; // ç²å¾—15%çš„æˆé•·æ•ˆæ‡‰
                            china.gdp += espionageBonus;
                            china.gdpTrend += espionageBonus * 0.3;
                            hasGrowthBonus = true;
                            
                            // ä½æ©Ÿç‡é¡¯ç¤ºæç¤º
                            if (Math.random() < 0.05) {
                                addEvent(`[å•†æ¥­é–“è«œ] ä¸­åœ‹å¾${gameState.countries[countryCode].name}çš„ç¶“æ¿Ÿæˆé•·ä¸­ç²ç›Š`, 'quarter-end');
                                if (selectedCountry === 'CHN') {
                                    showNewsAlert('æŠ€è¡“å­¸ç¿’', 'ğŸ•µï¸ é€éå•†æ¥­åˆä½œç²å¾—æŠ€è¡“æº¢å‡ºæ•ˆç›Šï¼', 'quarter-report');
                                }
                            }
                            return; // æ¯æ¬¡æ›´æ–°åªè§¸ç™¼ä¸€æ¬¡
                        }
                    }
                }
            });
        }

        // ç¾åœ‹è¢«å‹•æŠ€èƒ½ï¼šå…¨çƒå½±éŸ¿åŠ›
        function updateUSAGlobalInfluence() {
            const usa = gameState.countries['USA'];
            
            // æª¢æŸ¥ç¾åœ‹é€šè†¨æ˜¯å¦åœ¨ä¸Šå‡
            if (usa.inflationTrend > 0.5) {
                const influenceStrength = Math.min(usa.inflationTrend * 0.3, 1.0); // å½±éŸ¿åŠ›å¼·åº¦ä¸Šé™
                
                Object.keys(gameState.countries).forEach(countryCode => {
                    if (countryCode !== 'USA') {
                        const otherCountry = gameState.countries[countryCode];
                        
                        // 25%æ©Ÿç‡å°å…¶ä»–åœ‹å®¶ç”¢ç”Ÿé€šè†¨æº¢å‡º
                        if (Math.random() < 0.25) {
                            const spilloverEffect = influenceStrength * 0.4; // 40%çš„æº¢å‡ºæ•ˆæ‡‰
                            otherCountry.inflation += spilloverEffect;
                            otherCountry.inflationTrend += spilloverEffect * 0.5;
                            
                            // ä½æ©Ÿç‡é¡¯ç¤ºæç¤º
                            if (Math.random() < 0.03) {
                                addEvent(`[å…¨çƒå½±éŸ¿åŠ›] ç¾åœ‹é€šè†¨å£“åŠ›å‘${otherCountry.name}å‚³å°`, 'quarter-end');
                                if (selectedCountry === 'USA') {
                                    showNewsAlert('å…¨çƒå‚³å°', 'ğŸŒ ç¾åœ‹é€šè†¨å£“åŠ›å‘å…¨çƒå‚³å°ï¼', 'economic-alert');
                                } else if (selectedCountry === countryCode) {
                                    showNewsAlert('å¤–éƒ¨å£“åŠ›', 'ğŸ“ˆ å—åˆ°ç¾åœ‹é€šè†¨å£“åŠ›å½±éŸ¿ï¼', 'warning');
                                }
                            }
                        }
                    }
                });
            }
        }

        // å¤§å¹…èª¿æ•´å¾Œçš„é€šç¸®èºæ—‹æ©Ÿåˆ¶ï¼ˆæ›´æº«å’Œï¼‰
        function updateDeflationEffect(country, countryCode) {
            if (country.inflation < -0.5) { // é€šç¸®é–¾å€¼é™ä½åˆ°-0.5%
                const deflationSeverity = Math.abs(country.inflation + 0.5); // çµ¦äºˆ0.5%çš„ç·©è¡
                
                // å¤§å¹…æ¸›è¼•åŸºç¤é€šç¸®å½±éŸ¿
                country.gdpTrend -= deflationSeverity * 0.2; // å¾0.4é€²ä¸€æ­¥é™åˆ°0.2
                country.gdp -= deflationSeverity * 0.02;     // å¾0.05é™åˆ°0.02
                country.confidence -= deflationSeverity * 0.5; // å¾1é™åˆ°0.5
                
                // åš´é‡é€šç¸®é¡å¤–æ‡²ç½°é–¾å€¼æé«˜åˆ° < -2.0%
                if (country.inflation < -2.0) { // å¾-1.5æé«˜åˆ°-2.0
                    country.gdpTrend -= 0.2; // å¾0.3é™åˆ°0.2
                    country.unemploymentTrend += 0.1; // å¾0.2é™åˆ°0.1
                    
                    if (Math.random() < 0.01) { // é€²ä¸€æ­¥é™ä½è§¸ç™¼é »ç‡
                        showNewsAlert('é€šç¸®èºæ—‹', 'ğŸŒªï¸ ç¶“æ¿Ÿé™·å…¥é€šç¸®èºæ—‹ï¼ä½†å¤®è¡Œæœ‰æ‡‰å°ç¶“é©—', 'warning');
                        addEvent(`[é€šç¸®å±æ©Ÿ] ${country.name}é¢è‡¨é€šç¸®æŒ‘æˆ°ï¼Œä½†æ”¿ç­–å·¥å…·ä»ç„¶æœ‰æ•ˆ`, 'quarter-end');
                    }
                }
            }
            
            // æ—¥æœ¬é€šç¸®é è­¦ç³»çµ±ï¼ˆå¤§å¹…èª¿æ•´é–¾å€¼ï¼‰
            if (countryCode === 'JPN' && selectedCountry === 'JPN') {
                checkJapanDeflationWarning(country);
            }
        }

        // å¤§å¹…èª¿æ•´æ—¥æœ¬é€šç¸®é è­¦é–¾å€¼
        function checkJapanDeflationWarning(country) {
            if (country.inflation < 0.2 && country.inflation >= -0.3) { // å¾0.5æé«˜åˆ°0.2ï¼Œè² å€¼ç·©è¡åˆ°-0.3
                if (Math.random() < 0.005) { // å¤§å¹…é™ä½æé†’é »ç‡
                    showNewsAlert('é€šç¸®é è­¦', 'âš ï¸ é€šè†¨åä½ï¼Œä½†ä»åœ¨å¯æ§ç¯„åœå…§', 'warning');
                }
            }
            if (country.inflation < -0.8) { // å¾-0.2æé«˜åˆ°-0.8ï¼Œçµ¦äºˆæ›´å¤§ç·©è¡
                if (Math.random() < 0.01) { 
                    showNewsAlert('é€šç¸®ç‹€æ…‹', 'ğŸš¨ æ—¥æœ¬é€²å…¥é€šç¸®ï¼Œä½†å¤®è¡Œå·¥å…·ä¾ç„¶æœ‰æ•ˆ', 'economic-alert');
                }
            }
        }

        function updateQuarterProgress() {
            const now = Date.now();
            const deltaTime = now - gameState.lastUpdateTime;
            gameState.lastUpdateTime = now;
            gameState.quarterProgress += deltaTime;

            const progressPercentage = (gameState.quarterProgress / gameState.quarterDuration) * 100;
            const progressElement = document.getElementById('progressFill');
            if (progressElement) progressElement.style.width = progressPercentage + '%';

            const remainingTime = Math.max(0, gameState.quarterDuration - gameState.quarterProgress);
            const minutes = Math.floor(remainingTime / 60000);
            const seconds = Math.floor((remainingTime % 60000) / 1000);
            const timeElement = document.getElementById('timeRemaining');
            if (timeElement) timeElement.textContent = minutes + ':' + seconds.toString().padStart(2, '0');

            if (gameState.quarterProgress >= gameState.quarterDuration) {
                endQuarter();
            }
        }

        // ===== æ”¿ç­–å¯¦æ–½å‡½æ•¸ =====
        function implementPolicy() {
            const country = gameState.countries[selectedCountry];
            
            // æª¢æŸ¥æ”¿ç­–å†·å»æœŸ
            if (country.policyCooldown > 0) {
                const remainingTime = Math.ceil(country.policyCooldown / 1000);
                showNewsAlert('æ”¿ç­–å†·å»', `æ”¿ç­–é‚„åœ¨å†·å»ä¸­ï¼Œè«‹ç­‰å¾… ${remainingTime} ç§’`, 'warning');
                return;
            }
            
            const newInterestRate = parseFloat(document.getElementById('interestRate').value);
            const newReserveRatio = parseInt(document.getElementById('reserveRatio').value);
            const interestRateChange = newInterestRate - country.interestRate;
            
            // è¨ˆç®—æ”¿ç­–æˆåŠŸæ©Ÿç‡
            let successRate = Math.max(0.3, Math.min(0.95, country.confidence / 100));
            if (country.fiscalDeficit > 12) {
                successRate *= 0.9;
            }
            
            const multiplier = getPolicyEffectMultiplier(country);
            const policySuccess = Math.random() < successRate;
            
            if (policySuccess) {
                // æ”¿ç­–æˆåŠŸ
                country.interestRate = newInterestRate;
                country.reserveRatio = newReserveRatio;

                if (interestRateChange !== 0) {
                    let inflationEffect = interestRateChange * 2.0 * multiplier.monetary;
                    let gdpEffect = interestRateChange * 1.0 * multiplier.monetary;
                    let unemploymentEffect = interestRateChange * 0.8 * multiplier.monetary;
                    
                    // æ—¥æœ¬æ”¿ç­–æ•ˆæœå¢å¼·ï¼ˆé€²ä¸€æ­¥èª¿æ•´ï¼‰
                    if (selectedCountry === 'JPN') {
                        inflationEffect *= 2.0; // å¾1.5å›èª¿åˆ°2.0ï¼Œå¢å¼·æ”¿ç­–æ•ˆæœ
                        
                        // ä½é€šè†¨æœŸé–“åˆºæ¿€æ”¿ç­–åŠ æˆï¼ˆèª¿æ•´æ¢ä»¶ï¼‰
                        if (country.inflation < 1.0 && interestRateChange < 0) { // å¾0.5èª¿æ•´åˆ°1.0
                            inflationEffect *= 2.2; // å¾1.8æé«˜åˆ°2.2
                            gdpEffect *= 1.5;       // ç¶­æŒ1.3â†’1.5
                            addEvent('[æ—¥æœ¬å„ªå‹¢] ä½é€šè†¨æœŸé–“è²¨å¹£æ”¿ç­–æ•ˆæœå¤§å¹…å¢å¼·', 'policy-change');
                        }
                    }
                    
                    country.inflationTrend -= inflationEffect;
                    country.gdpTrend -= gdpEffect;
                    country.unemploymentTrend += unemploymentEffect;
                }

                let message = `[${countryConfigs[selectedCountry].name}] å¤®è¡Œæ”¿ç­–æˆåŠŸå¯¦æ–½ï¼šåŸºæº–åˆ©ç‡ ${newInterestRate}%`;
                if (multiplier.message) {
                    message += ` (${multiplier.message})`;
                }
                addEvent(message, 'policy-change');
                country.confidence += 0.5;
                
            } else {
                // æ”¿ç­–å¤±æ•—é‚è¼¯ä¿æŒä¸è®Š
                country.interestRate = newInterestRate;
                country.reserveRatio = newReserveRatio;

                if (interestRateChange !== 0) {
                    country.inflationTrend -= interestRateChange * 1.0 * multiplier.monetary;
                    country.gdpTrend -= interestRateChange * 0.5 * multiplier.monetary;
                    country.unemploymentTrend += interestRateChange * 0.4 * multiplier.monetary;
                    
                    country.inflationTrend += (Math.random() - 0.5) * 0.5;
                    country.gdpTrend += (Math.random() - 0.5) * 0.3;
                }

                addEvent(`[${countryConfigs[selectedCountry].name}] å¤®è¡Œæ”¿ç­–æ•ˆæœä¸ä½³ï¼šå¸‚å ´ä¿¡å¿ƒä¸è¶³å½±éŸ¿æ”¿ç­–å‚³å°`, 'policy-change');
                showNewsAlert('æ”¿ç­–æ•ˆæœä¸ä½³', 'ç”±æ–¼æ°‘çœ¾ä¿¡å¿ƒä¸è¶³ï¼Œæ”¿ç­–æ•ˆæœå¤§æ‰“æŠ˜æ‰£ï¼', 'warning');
                country.confidence -= 1.0;
            }
            
            // è¨­å®šæ”¿ç­–å†·å»æœŸï¼ˆ10ç§’ï¼‰
            country.policyCooldown = 10000;
            updatePolicyCooldownDisplay();
        }

        function increaseGovernmentSpending() {
            const country = gameState.countries[selectedCountry];
            
            if (country.policyCooldown > 0) {
                const remainingTime = Math.ceil(country.policyCooldown / 1000);
                showNewsAlert('æ”¿ç­–å†·å»', `æ”¿ç­–é‚„åœ¨å†·å»ä¸­ï¼Œè«‹ç­‰å¾… ${remainingTime} ç§’`, 'warning');
                return;
            }

            if (country.govSpendingLevel >= 5) {
                showNewsAlert('æ”¯å‡ºä¸Šé™', 'æ”¿åºœæ”¯å‡ºå·²é”æœ€é«˜æ°´å¹³ï¼', 'warning');
                return;
            }

            let successRate = Math.max(0.3, Math.min(0.95, country.confidence / 100));
            if (country.fiscalDeficit > 12) {
                successRate *= 0.9;
            }

            const multiplier = getPolicyEffectMultiplier(country);
            const policySuccess = Math.random() < successRate;
            
            if (policySuccess) {
                country.govSpendingLevel += 1;
                
                let unemploymentEffect = 1.5 * multiplier.fiscal;
                let gdpEffect = 0.5 * multiplier.fiscal;
                let inflationEffect = 0.4;
                
                // æ—¥æœ¬ä½é€šè†¨æœŸé–“è²¡æ”¿åˆºæ¿€åŠ æˆï¼ˆé€²ä¸€æ­¥å¢å¼·ï¼‰
                if (selectedCountry === 'JPN') {
                    if (country.inflation < 1.5) { // å¾0.8èª¿æ•´åˆ°1.5ï¼Œæ›´æ—©è§¸ç™¼
                        unemploymentEffect *= 1.8; // å¾1.5æé«˜åˆ°1.8
                        gdpEffect *= 1.8;          // å¾1.5æé«˜åˆ°1.8
                        inflationEffect *= 2.2;    // å¾1.8æé«˜åˆ°2.2
                        addEvent('[æ—¥æœ¬å„ªå‹¢] ä½é€šè†¨æœŸé–“è²¡æ”¿åˆºæ¿€æ•ˆæœå¤§å¹…å¢å¼·', 'policy-change');
                    }
                }
                
                country.unemployment -= unemploymentEffect;
                country.gdp += gdpEffect;
                country.fiscalDeficit += 2.5;
                
                country.unemploymentTrend -= 0.5 * multiplier.fiscal;
                country.gdpTrend += 0.3 * multiplier.fiscal;
                country.inflationTrend += inflationEffect;
                
                updateSpendingLevelDisplay();
                
                let message = `[è²¡æ”¿æ”¿ç­–] å¢åŠ æ”¿åºœæ”¯å‡ºæˆåŠŸï¼å¤±æ¥­ç‡ç«‹å³ä¸‹é™${unemploymentEffect.toFixed(1)}%ï¼ŒGDPç«‹å³æå‡${gdpEffect.toFixed(1)}%`;
                if (multiplier.message) {
                    message += ` (${multiplier.message})`;
                }
                addEvent(message, 'policy-change');
                showNewsAlert('è²¡æ”¿åˆºæ¿€', 'ğŸ›ï¸ æ”¿åºœæ”¯å‡ºå¢åŠ ï¼å¤§è¦æ¨¡å°±æ¥­è¨ˆåŠƒç«‹å³å•Ÿå‹•', 'quarter-report');
                
            } else {
                addEvent(`[è²¡æ”¿æ”¿ç­–] å¢åŠ æ”¿åºœæ”¯å‡ºé­åˆ°é˜»ç¤™ï¼Œæ•ˆæœæœ‰é™`, 'policy-change');
                showNewsAlert('æ”¿ç­–å—é˜»', 'åœ‹æœƒå°å¢åŠ æ”¯å‡ºå­˜åœ¨åˆ†æ­§ï¼Œæ•ˆæœæ‰“æŠ˜ï¼', 'warning');
                
                country.govSpendingLevel += 1;
                country.unemployment -= 0.75 * multiplier.fiscal;
                country.gdp += 0.25 * multiplier.fiscal;
                country.fiscalDeficit += 2.5;
                
                country.unemploymentTrend -= 0.25 * multiplier.fiscal;
                country.gdpTrend += 0.15 * multiplier.fiscal;
                country.inflationTrend += 0.2;
                
                updateSpendingLevelDisplay();
            }

            country.policyCooldown = 10000;
            updatePolicyCooldownDisplay();
        }

        function decreaseGovernmentSpending() {
            const country = gameState.countries[selectedCountry];
            
            if (country.policyCooldown > 0) {
                const remainingTime = Math.ceil(country.policyCooldown / 1000);
                showNewsAlert('æ”¿ç­–å†·å»', `æ”¿ç­–é‚„åœ¨å†·å»ä¸­ï¼Œè«‹ç­‰å¾… ${remainingTime} ç§’`, 'warning');
                return;
            }

            if (country.govSpendingLevel <= -3) {
                showNewsAlert('æ”¯å‡ºä¸‹é™', 'æ”¿åºœæ”¯å‡ºå·²é”æœ€ä½æ°´å¹³ï¼', 'warning');
                return;
            }

            let successRate = Math.max(0.3, Math.min(0.95, country.confidence / 100));
            if (country.fiscalDeficit > 12) {
                successRate *= 0.9;
            }

            const multiplier = getPolicyEffectMultiplier(country);
            const policySuccess = Math.random() < successRate;
            
            if (policySuccess) {
                country.govSpendingLevel -= 1;
                
                country.unemployment += 1.5 * multiplier.fiscal;
                country.gdp -= 0.5 * multiplier.fiscal;
                country.fiscalDeficit -= 2.0;
                
                country.unemploymentTrend += 0.3 * multiplier.fiscal;
                country.gdpTrend -= 0.2 * multiplier.fiscal;
                country.inflationTrend -= 0.3;
                
                updateSpendingLevelDisplay();
                
                let message = `[è²¡æ”¿æ”¿ç­–] æ¸›å°‘æ”¿åºœæ”¯å‡ºæˆåŠŸï¼è²¡æ”¿è² æ“”æ¸›è¼•ï¼Œä½†å¤±æ¥­ç‡ç«‹å³ä¸Šå‡${(1.5 * multiplier.fiscal).toFixed(1)}%`;
                if (multiplier.message) {
                    message += ` (${multiplier.message})`;
                }
                addEvent(message, 'policy-change');
                showNewsAlert('è²¡æ”¿ç·Šç¸®', 'ğŸ’° æ”¿åºœæ”¯å‡ºå‰Šæ¸›ï¼è²¡æ”¿ç‹€æ³æ”¹å–„ä½†å°±æ¥­ç«‹å³å—å½±éŸ¿', 'quarter-report');
                
            } else {
                addEvent(`[è²¡æ”¿æ”¿ç­–] æ¸›å°‘æ”¿åºœæ”¯å‡ºé­åˆ°åå°ï¼Œæ•ˆæœæœ‰é™`, 'policy-change');
                showNewsAlert('æ”¿ç­–é˜»åŠ›', 'å·¥æœƒå’Œæ°‘çœ¾åå°å‰Šæ¸›æ”¯å‡ºï¼', 'warning');
                
                country.govSpendingLevel -= 1;
                country.unemployment += 0.75 * multiplier.fiscal;
                country.gdp -= 0.25 * multiplier.fiscal;
                country.fiscalDeficit -= 2.0;
                
                country.unemploymentTrend += 0.15 * multiplier.fiscal;
                country.gdpTrend -= 0.1 * multiplier.fiscal;
                country.inflationTrend -= 0.15;
                
                updateSpendingLevelDisplay();
            }

            country.policyCooldown = 10000;
            updatePolicyCooldownDisplay();
        }

        function emergencyFiscalStimulus() {
            const country = gameState.countries[selectedCountry];
            
            if (country.emergencyUsed) {
                showNewsAlert('å·¥å…·å·²ç”¨', 'ç·Šæ€¥åˆºæ¿€å·¥å…·å·²åœ¨æœ¬è¼ªéŠæˆ²ä¸­ä½¿ç”¨é', 'warning');
                return;
            }
            
            if (getCrisisLevel(country) !== 'severe') {
                showNewsAlert('æ¢ä»¶ä¸ç¬¦', 'åƒ…åœ¨åš´é‡å±æ©Ÿæ™‚å¯ä½¿ç”¨ç·Šæ€¥åˆºæ¿€å·¥å…·', 'warning');
                return;
            }
            
            country.unemployment -= 3.0;
            country.gdp += 2.0;
            country.fiscalDeficit += 8.0;
            country.confidence += 10;
            
            country.emergencyUsed = true;
            updateEmergencyToolDisplay();
            
            addEvent('[ç·Šæ€¥æªæ–½] å•Ÿå‹•å²ç„¡å‰ä¾‹çš„ç¶“æ¿Ÿåˆºæ¿€è¨ˆåŠƒï¼', 'policy-change');
            showNewsAlert('ç·Šæ€¥åˆºæ¿€', 'ğŸš¨ æ”¿åºœå‹•ç”¨ä¸€åˆ‡æ‰‹æ®µæ•‘å¸‚ï¼', 'economic-alert');
        }

        function togglePause() {
            gameState.isGamePaused = !gameState.isGamePaused;
            const pauseBtn = document.getElementById('pauseBtn');
            
            if (gameState.isGamePaused) {
                pauseBtn.textContent = 'æ¢å¾©éŠæˆ²';
                pauseBtn.className = 'btn-secondary';
                addEvent('[ç³»çµ±] éŠæˆ²å·²æš«åœ');
            } else {
                pauseBtn.textContent = 'æš«åœéŠæˆ²';
                pauseBtn.className = 'btn-danger';
                gameState.lastUpdateTime = Date.now();
                addEvent('[ç³»çµ±] éŠæˆ²å·²æ¢å¾©');
            }
        }

        function updatePolicyCooldown() {
            const country = gameState.countries[selectedCountry];
            if (country && country.policyCooldown > 0) {
                country.policyCooldown -= 100;
                updatePolicyCooldownDisplay();
                updateSpendingLevelDisplay();
            }
        }

        function updatePolicyCooldownDisplay() {
            const country = gameState.countries[selectedCountry];
            if (!country) return;
            
            const implementBtn = document.getElementById('implementBtn');
            
            if (country.policyCooldown > 0) {
                const remainingSeconds = Math.ceil(country.policyCooldown / 1000);
                implementBtn.textContent = `å†·å»ä¸­ (${remainingSeconds}s)`;
                implementBtn.disabled = true;
                implementBtn.style.background = '#95a5a6';
            } else {
                implementBtn.textContent = 'å¯¦æ–½æ”¿ç­–';
                implementBtn.disabled = false;
                implementBtn.style.background = 'linear-gradient(45deg, #3498db, #2980b9)';
            }
        }

        function updateSpendingLevelDisplay() {
            const country = gameState.countries[selectedCountry];
            if (!country) return;
            
            const display = document.getElementById('spendingLevelDisplay');
            
            if (display) {
                let label = 'ä¸­æ€§';
                if (country.govSpendingLevel > 0) {
                    label = `æ“´å¼µ +${country.govSpendingLevel}`;
                } else if (country.govSpendingLevel < 0) {
                    label = `ç·Šç¸® ${country.govSpendingLevel}`;
                }
                display.textContent = label;
                
                const increaseBtn = document.getElementById('increaseSpendingBtn');
                const decreaseBtn = document.getElementById('decreaseSpendingBtn');
                
                if (increaseBtn) {
                    increaseBtn.disabled = (country.govSpendingLevel >= 5 || country.policyCooldown > 0);
                }
                if (decreaseBtn) {
                    decreaseBtn.disabled = (country.govSpendingLevel <= -3 || country.policyCooldown > 0);
                }
            }
        }

        function updateEmergencyToolDisplay() {
            const country = gameState.countries[selectedCountry];
            if (!country) return;
            
            const emergencyBtn = document.getElementById('emergencyBtn');
            
            if (emergencyBtn) {
                const crisisLevel = getCrisisLevel(country);
                const canUse = crisisLevel === 'severe' && !country.emergencyUsed;
                
                emergencyBtn.disabled = !canUse;
                emergencyBtn.style.display = crisisLevel === 'severe' ? 'block' : 'none';
                
                if (country.emergencyUsed) {
                    emergencyBtn.textContent = 'ğŸš« å·²ä½¿ç”¨ç·Šæ€¥åˆºæ¿€';
                    emergencyBtn.style.background = '#95a5a6';
                } else if (canUse) {
                    emergencyBtn.textContent = 'ğŸš¨ ç·Šæ€¥è²¡æ”¿åˆºæ¿€';
                    emergencyBtn.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                }
            }
        }

        // ===== éš¨æ©Ÿäº‹ä»¶ç³»çµ± =====
        function triggerRandomEvent() {
            const events = [
                {
                    title: "å…¨çƒè‚¡å¸‚æš´è·Œ",
                    description: "æŠ•è³‡è€…ææ…Œæƒ…ç·’è”“å»¶ï¼Œå…¨çƒè‚¡å¸‚é›†é«”ä¸‹è·Œ",
                    effect: function() {
                        for (let code in gameState.countries) {
                            const country = gameState.countries[code];
                            country.gdp -= 1.5;
                            country.confidence -= 10;
                            country.unemployment += 0.5;
                        }
                    }
                },
                {
                    title: "ç§‘æŠ€å‰µæ–°çªç ´",
                    description: "é‡å¤§ç§‘æŠ€çªç ´æ¨å‹•ç”Ÿç”¢åŠ›æå‡",
                    effect: function() {
                        for (let code in gameState.countries) {
                            const country = gameState.countries[code];
                            country.gdp += 1.0;
                            country.confidence += 8;
                            country.unemployment -= 0.3;
                        }
                    }
                },
                {
                    title: "èƒ½æºåƒ¹æ ¼é£†å‡",
                    description: "åœ°ç·£æ”¿æ²»ç·Šå¼µæ¨é«˜èƒ½æºåƒ¹æ ¼",
                    effect: function() {
                        for (let code in gameState.countries) {
                            const country = gameState.countries[code];
                            country.inflation += 2.0;
                            country.gdp -= 0.8;
                            country.confidence -= 5;
                        }
                    }
                },
                {
                    title: "åœ‹éš›è²¿æ˜“å”å®šç°½ç½²",
                    description: "æ–°çš„è²¿æ˜“å”å®šä¿ƒé€²å…¨çƒè²¿æ˜“",
                    effect: function() {
                        for (let code in gameState.countries) {
                            const country = gameState.countries[code];
                            country.gdp += 0.8;
                            country.confidence += 6;
                            country.inflation -= 0.2;
                        }
                    }
                }
            ];
            
            const selectedEvent = events[Math.floor(Math.random() * events.length)];
            selectedEvent.effect();
            
            showNewsAlert('çªç™¼äº‹ä»¶', 'ğŸŒ ' + selectedEvent.title + ': ' + selectedEvent.description, 'global-event');
            addEvent('[å…¨çƒäº‹ä»¶] ' + selectedEvent.title, 'quarter-end');
        }

        // ===== å·¥å…·å‡½æ•¸ =====
        function addEvent(message, type = 'normal') {
            const eventsContainer = document.getElementById('eventsContainer');
            if (!eventsContainer) return;
            
            const eventDiv = document.createElement('div');
            eventDiv.className = 'event-item ' + type;
            const timestamp = new Date().toLocaleTimeString();
            eventDiv.innerHTML = '<strong>[' + timestamp + ']</strong> ' + message;
            eventsContainer.insertBefore(eventDiv, eventsContainer.firstChild);
            
            if (eventsContainer.children.length > 10) {
                eventsContainer.removeChild(eventsContainer.lastChild);
            }
        }

        function showNewsAlert(title, content, type = 'warning') {
            const alertElement = document.getElementById('newsAlert');
            const titleElement = document.getElementById('newsAlertTitle');
            const contentElement = document.getElementById('newsAlertContent');
            
            if (alertElement && titleElement && contentElement) {
                titleElement.textContent = title;
                contentElement.textContent = content;
                alertElement.className = 'news-alert ' + type;
                alertElement.style.display = 'block';
                
                setTimeout(() => {
                    closeNewsAlert();
                }, 5000);
            }
        }

        function closeNewsAlert() {
            const alertElement = document.getElementById('newsAlert');
            if (alertElement) alertElement.style.display = 'none';
        }

        function continueToNextYear() {
            for (let countryCode in gameState.countries) {
                const country = gameState.countries[countryCode];
                country.yearlyGdp = [];
                country.yearlyInflation = [];
                country.yearlyUnemployment = [];
                country.yearlyConfidence = [];
            }

            const reportElement = document.getElementById('yearlyReport');
            if (reportElement) reportElement.remove();

            gameState.isGamePaused = false;
            gameState.lastUpdateTime = Date.now();
            
            showNewsAlert('æ–°å¹´åº¦é–‹å§‹', 'ğŸŠ æ–°å¹´åº¦é–‹å§‹ï¼ç¹¼çºŒä½ çš„å¤®è¡Œæ²»ç†æŒ‘æˆ°ï¼', 'quarter-report');
            addEvent('[æ–°å¹´åº¦] æ–°å¹´åº¦é–‹å§‹ï¼Œç¹¼çºŒå¤®è¡Œæ”¿ç­–æŒ‘æˆ°ï¼');
        }

        function restartGame() {
            if (confirm('ç¢ºå®šè¦é‡æ–°é–‹å§‹éŠæˆ²å—ï¼Ÿ')) {
                location.reload();
            }
        }

        // ===== é é¢è¼‰å…¥å’Œæ¸…ç† =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸŒ é é¢è¼‰å…¥å®Œæˆï¼Œè¨­ç½®åœ‹å®¶é¸æ“‡...');
            setupCountrySelection();
        });

        window.addEventListener('beforeunload', function() {
            if (updateTimer) {
                clearInterval(updateTimer);
            }
        });

    </script>
</body>
</html>
            